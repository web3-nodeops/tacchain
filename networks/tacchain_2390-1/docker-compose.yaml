services:
  tac-turin-testnet-init:
    user: "${USER_ID}:${GROUP_ID}"
    image: tacchain:v0.0.7-testnet
    env_file:
      - .env.turin
    volumes:
      - "./:/data"
    entrypoint: /bin/sh
    command: >
      -c "[ ! -e /data/config/config.toml ] && tacchaind init $MONIKER --chain-id tacchain_2390-1 --home /data && cd /data/config && rm genesis.json && wget https://raw.githubusercontent.com/TacBuild/tacchain/refs/heads/main/networks/tacchain_2390-1/genesis.json || exit 0"

  tac-turin-testnet-validator-1:
    user: "${USER_ID}:${GROUP_ID}"
    network_mode: host
    restart: unless-stopped
    image: tacchain:v0.0.7-testnet
    env_file:
      - .env.turin
    volumes:
      - "./:/data"
    depends_on:
      tac-turin-testnet-init:
        condition: service_completed_successfully
    entrypoint: tacchaind
    command: >
      start
      --chain-id=tacchain_2390-1
      --home=/data
      --db_dir=data
      --pruning=default
      --log_level=info
      --p2p.persistent_peers="f8124878e3526a9814c0a5f865820c5ea7eb26f8@72.251.230.233:45130,4a03d6622a2ad923d79e81951fe651a17faf0be8@107.6.94.246:45130,ea5719fe6587b18ed0fee81f960e23c65c0e0ccc@206.217.210.164:45130"
      --p2p.laddr=tcp://0.0.0.0:${P2P_PORT}
      --p2p.external-address=${EXT_IP}:${P2P_PORT}
      --rpc.laddr=tcp://0.0.0.0:${RPC_PORT}
      --json-rpc.address=0.0.0.0:${RPC_PORT_EVM}
      --json-rpc.ws-address=0.0.0.0:${WS_PORT_EVM}
